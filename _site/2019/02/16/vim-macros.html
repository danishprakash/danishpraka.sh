<!DOCTYPE html>
<html>

    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

        <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-101783497-1', 'auto');
  ga('send', 'pageview');

</script>


        
        <title>Vim macros and the magic of recursion</title>
        

        <meta name="description" content="">

        <link rel="icon" href="/assets/img/favicon.png">
        <link href="https://fonts.googleapis.com/css?family=IBM+Plex+Mono:300,400,500" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Noto+Serif+JP:300,400,500,600" rel="stylesheet"> 

        <link rel="stylesheet" type="text/css" href="/assets/css/main.css">
    </head>

    <body>

        <div class="wrapper">
            <div class="post">
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-101783497-1', 'auto');
  ga('send', 'pageview');

</script>

	<a class="post__back" href="/">←</a>
    <h1 class="post__title">Vim macros and the magic of recursion</h1>
    <p class="post__date">February 16, 2019</p>
    <div class="post__content"?>
        <p>The other day, a friend of mine asked me for a list of Indian states and their capitals in JSON format. We looked around the internet but couldn’t find one which gave us the list in a format we could readily make use of. Finally, he copied a list from <a href="http://adaniel.tripod.com/statelist.htm">this</a> page which was rendered as an HTML table and upon copying, it messed up. I quickly copied this list to a Vim buffer to try something out.</p>

<h1 id="vim-macros">Vim macros</h1>
<p>Macros in Vim are defined as recordings of commands which you can save to a particular register and replay later on. You can also think of them as functions in a way because they offer you to avoid doing repeatable tasks. Coming back to the list of states, it looked something like this:</p>

<div class="language-text highlighter-rouge"><pre class="highlight"><code>Andhra Pradesh
	

Hyderabad, Amaravati

Arunachal Pradesh
	

Itangar

Assam
	

Dispur

Bihar
	

Patna

Chhattisgarh
	

Raipur
</code></pre>
</div>

<p>I’ve snipped the whole output of this for brevity but you get the idea. Essentially, what we have here is the name of the city, followed by two newlines and then the name of it’s capital, repeated for all of the 27 states. Nevermind the mess, let’s get to it.</p>

<p>You alread know that a macro is a sequence of commands which you can execute again and again by specifying the register to which the command is spaced. So, all I need to do is come up with a sequence and then repeat it <code class="highlighter-rouge">n</code> times.</p>

<p>Start recording the macro by hitting the <code class="highlighter-rouge">q</code>. For the first state, we can build a key value pair using what we have using the following sequence of commands, assuming you are on the first line of the file:</p>

<ul>
  <li><code class="highlighter-rouge">qq</code>: start recording the macro into register <code class="highlighter-rouge">q</code></li>
  <li><code class="highlighter-rouge">0</code>: move cursor to first char</li>
  <li><code class="highlighter-rouge">4J</code>: join the 3 lines below the current one</li>
  <li><code class="highlighter-rouge">hi:Esc</code>: move cursor one position left and insert colon</li>
  <li><code class="highlighter-rouge">I"Esc</code>: insert quote before the first char on line</li>
  <li><code class="highlighter-rouge">t:a"Esc</code>: insert quote before the colon char</li>
  <li><code class="highlighter-rouge">wi"Esc</code>: insert quote on the beg of the next word</li>
  <li><code class="highlighter-rouge">A",Esc</code>: insert quote and a comma to the end of line</li>
  <li><code class="highlighter-rouge">jdd</code>: delete the next empty line and put the cursor on the next non-empty line</li>
</ul>

<p>That might seem like a lot but it really is just a sequence of easy to understand Vim commands. You can hit <code class="highlighter-rouge">q</code> again to stop recording the macro. When you are done recording, you would have ended up on a new line, a new state. You can hit <code class="highlighter-rouge">@q</code> to replay the commands stored in the <code class="highlighter-rouge">q</code> register. It will instantly repeat the commands we just tried out. <code class="highlighter-rouge">@@</code> is a shortcut to run previously run macro.</p>

<h1 id="recursive-vim-macros">Recursive Vim macros</h1>
<p>Now, you don’t want to go about hitting <code class="highlighter-rouge">@q</code> or <code class="highlighter-rouge">@@</code> 26 times. You can make use of recursive Vim macros to get away with repetitive tasks which involve macros. We will make a small addition to the list of commands that we ran previously. All we need to do is to repeat the macro when we are on a new line and as already discussed previously, we can use <code class="highlighter-rouge">@&lt;register&gt;</code> to replay the macro stored in <register>. So, our new set of commands would be</register></p>

<ul>
  <li><code class="highlighter-rouge">qq</code>: start recording the macro into register <code class="highlighter-rouge">q</code></li>
  <li><code class="highlighter-rouge">0</code>: move cursor to first char</li>
  <li><code class="highlighter-rouge">4J</code>: join the 3 lines below the current one</li>
  <li><code class="highlighter-rouge">hi:Esc</code>: move cursor one position left and insert colon</li>
  <li><code class="highlighter-rouge">I"Esc</code>: insert quote before the first char on line</li>
  <li><code class="highlighter-rouge">t:a"Esc</code>: insert quote before the colon char</li>
  <li><code class="highlighter-rouge">wi"Esc</code>: insert quote on the beg of the next word</li>
  <li><code class="highlighter-rouge">A",Esc</code>: insert quote and a comma to the end of line</li>
  <li><code class="highlighter-rouge">jdd</code>: delete the next empty line and put the cursor on the next non-empty line</li>
  <li><code class="highlighter-rouge">@q</code>: To replay this macro at the beginning of a new line assuming the fact that we have used <code class="highlighter-rouge">q</code> to save our macro.</li>
</ul>

<p>Once you enter this somewhat arcane list of normal commands while being on the first non-empty line of the buffer, you will see that Vim “magically” arranges everything for you and now you have this almost JSON-like file which you can read using Python and whatnot. I said almost JSON-like because it is missing the opening and closing parenthesis at the end and beginning of the file which you can just go ahead and put in manually. Your buffer should now look something like this:</p>

<div class="language-text highlighter-rouge"><pre class="highlight"><code>{
    "Andra Pradesh": "Hyderabad, Amaravati",
    "Arunachal Pradesh": "Itangar",
    "Assam": "Dispur",
    "Bihar": "Patna",
    "Chhattisgarh": "Raipur",
    "Goa": "Panaji",
    "Gujarat": "Gandhinagar",
    "Haryana": "Chandigarh",
    "Himachal Pradesh": "Shimla",
    "Jammu and Kashmir": "Srinagar and Jammu",
    "Jharkhand": "Ranchi",
    "Karnataka": "Bangalore",
    "Kerala": "Thiruvananthapuram",
    "Madya Pradesh": "Bhopal",
    "Maharashtra": "Mumbai",
    "Manipur": "Imphal",
    "Meghalaya": "Shillong",
    "Mizoram": "Aizawi",
    "Nagaland": "Kohima",
    "Orissa": "Bhubaneshwar",
    "Punjab": "Chandigarh",
    "Rajasthan": "Jaipur",
    "Sikkim": "Gangtok",
    "Tamil Nadu": "Chennai",
    "Telagana": "Hyderabad",
    "Tripura": "Agartala",
    "Uttaranchal": "Dehradun",
    "Uttar Pradesh": "Lucknow",
    "West Bengal": "Kolkata",
}
</code></pre>
</div>
<p><br /></p>

<h1 id="other-uses">Other uses</h1>
<p>This might have been trivial for some of you reading but if you think about the underlying idea this article proposes, you can put Vim macros to a variety of uses. I’ve used Vim macros often times, in fact whenever I see myself repeating normal mode commands, I try to do the same using recursive macros. Some of my recent uses involving Vim macros are:</p>

<ul>
  <li>Transform all the keys in a Go map from uppercase to lowercase</li>
  <li>Remove multiple values from a Python dict and adding a new one</li>
  <li>Add a newline to lines in a file which matches a certain pattern</li>
</ul>

<p>It’s fun to solve problems in a unique way, albeit somewhat time consuming initially. They tend to pay off at the end in a sense that you get to learn a skill which comes in handy for times to come. Vim macros are a powerful way to level up your editing game. Learn more about macros in Vim using <code class="highlighter-rouge">:h macro</code>.</p>

<hr />

    </div>
</div>

        </div>

    </body>

</html>

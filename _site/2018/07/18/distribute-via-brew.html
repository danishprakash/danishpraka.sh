<!DOCTYPE html>
<html>

    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

        <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-101783497-1', 'auto');
  ga('send', 'pageview');

</script>


        
        <title>Distribute your application via Homebrew</title>
        

        <meta name="description" content="">

        <link rel="icon" href="/assets/img/favicon.png">
        <link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:300,400,500|IBM+Plex+Mono:300,400,500,600" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="/assets/css/main.css">
    </head>

    <body>

        <div class="wrapper">
            <div class="post">
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-101783497-1', 'auto');
  ga('send', 'pageview');

</script>

	<a class="post__back" href="/">←</a>
    <h1 class="post__title">Distribute your application via Homebrew</h1>
    <p class="post__date">July 18, 2018</p>
    <div class="post__content"?>
        <p>I was confronted with a problem when I was writing the documentation of a command-line application I recently wrote, <a href="https://github.com/prakashdanish/goodreadsh"><code class="highlighter-rouge">goodreadsh</code></a>. The problem was how to allow users to install my application, should I ask them to <code class="highlighter-rouge">curl</code> the script and add it to their <code class="highlighter-rouge">PATH</code> and finally give it executable permissions? Because that is precisely how I’ve done it for a few applications I’ve built in the past. Then it hit me, I could atleast do my fellow mac users a favor and have my application available via homebrew. Not that there’s anything wrong with having to install an application manually, I still do that often but typing 2 trivial commands instead of 4 seems like a sensible move.</p>

<p>There are essentialy two steps in this process:</p>

<ul>
  <li>Writing a formula for your application.</li>
  <li>Creating a tap to host your formula file.</li>
</ul>

<p>Don’t worry about the terminology just yet, we’ll get to know them as and when required.</p>

<h1 id="your-applications-tar-archive">Your application’s <code class="highlighter-rouge">tar</code> archive</h1>
<p>Homebrew accepts a tar archive of your application in order to process it. We can generate one by simple creating a new release on your project’s github repository. Once you’ve successfully created a release, click on the releases tab and find the link to the tar archive below the release label. My application’s <a href="https://github.com/prakashdanish/goodreadsh/releases">release(s)</a> for example.</p>

<h1 id="write-your-formula">Write your formula</h1>
<p>Homebrew formulae are essentially ruby scripts which stores information about your application. It tells homebrew important information regarding the installation of your application like where and how your app is going to be installed. This is what a simple formula for an application written in bash would look like.</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Goodreadsh</span> <span class="o">&lt;</span> <span class="no">Formula</span>
	<span class="n">desc</span> <span class="s2">"Command-line interface for Goodreads"</span>
	<span class="n">homepage</span> <span class="s2">"https://github.com/prakashdanish/goodreadsh"</span>
	<span class="n">url</span> <span class="s2">"https://github.com/prakashdanish/goodreadsh/archive/1.0.1.tar.gz"</span>
	<span class="n">sha256</span> <span class="s2">"63d1de17449611f1490b1930e63cc8890f9f10c7e317f02c901e6a79236c10e2"</span>
	<span class="n">head</span> <span class="s2">"https://github.com/prakashdanish/goodreadsh.git"</span>

	<span class="k">def</span> <span class="nf">install</span>
		<span class="n">bin</span><span class="p">.</span><span class="nf">install</span> <span class="s2">"goodreads"</span>
	<span class="k">end</span>

	<span class="nb">test</span> <span class="k">do</span>
		<span class="nb">system</span> <span class="s2">"</span><span class="si">#{</span><span class="n">bin</span><span class="si">}</span><span class="s2">/goodreads"</span>
	<span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<p>Now, almost all of the fields here are pretty much self-explanatory but we’ll go through them quickly.</p>

<ul>
  <li><code class="highlighter-rouge">desc</code>: small description of your application, make sure you don’t end it with a period (.)</li>
  <li><code class="highlighter-rouge">homepage</code>: a webpage for your project, if you don’t have one, the project’s github repo will do.</li>
  <li><code class="highlighter-rouge">url</code>: this is the url of your application’s tar archive. Use the project’s github repo if you don’t have one.</li>
  <li><code class="highlighter-rouge">sha256</code>: this is the <code class="highlighter-rouge">sha</code> value of your application’s tar for authentication. You can calculate the <code class="highlighter-rouge">sha</code> value of your application using the command <code class="highlighter-rouge">openssl dgst -sha256 &lt;(curl -s -L &lt;URL&gt;)</code> where <code class="highlighter-rouge">URL</code> is the link to the tar archive to your application.</li>
  <li><code class="highlighter-rouge">head</code>: a link to your github repo since Homebrew can understand several vcs, this option is sometimes used to install your application using the <code class="highlighter-rouge">--HEAD</code> option for development purposes.</li>
</ul>

<p><br />
You can use this template or you can generate a formula of your own. Homebrew provides a simple command for this. <code class="highlighter-rouge">brew create &lt;URL&gt;</code></p>

<div class="language-sh highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>brew create https://github.com/prakashdanish/goodreadsh/archive/1.0.1.tar.gz
</code></pre>
</div>

<p>The <code class="highlighter-rouge">URL</code> in question is the link to the tar archive of your application. I’m using the one created automatically by Github when you create a new release and/or tag. As soon as you execute this command, an editor will open up with the formula.</p>

<p>You can check whether your formula is working or not by installing your application from specifying the formula.</p>

<div class="language-sh highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>brew install --build-from-source &lt;formula.rb&gt;
</code></pre>
</div>

<p>If it works, good enough. Now make sure your formula abides by the guidelines defined by homebrew using this command. Rectify any errors or warnings if there.</p>

<div class="language-sh highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>brew audit --strict &lt;formula.rb&gt;
</code></pre>
</div>

<h1 id="install--test">Install &amp; Test</h1>
<p>Since this is a rather trivial application that we’re writing a formula for, the formula for this would also be a simple one. You can have multiple things defined in your formula depending upon what you expect it to do.</p>

<p>Moving ahead, we can see a function definition <code class="highlighter-rouge">install</code> in which there’s a single expression <code class="highlighter-rouge">bin.install "goodreads"</code>. This will move the file in double quotes into the Formula’s bin directory and make it executable (<code class="highlighter-rouge">chmod 0555 goodreads</code>).</p>

<p>Similarly in the second function definition <code class="highlighter-rouge">test</code>, we execute the installed executable with the <code class="highlighter-rouge">system</code> command in ruby which is used to execute commands from within ruby scripts. The <code class="highlighter-rouge">system</code> function takes a single quoted argument which is the absolute path to the executable.</p>

<h1 id="putting-it-together">Putting it together</h1>
<p>Before moving one, there’s one thing I’d like to make clear. There are more than one way to allow users to allow installing your application via homebrew. First, having your application formula in the <code class="highlighter-rouge">homebrew-core</code> repository and the second is creating a tap. Having your application formula accepted in <code class="highlighter-rouge">homebrew-core</code> isn’t very straightforward since there are various rules that determine whether a package should be in the <code class="highlighter-rouge">homebrew-core</code> repo, for instance, your application’s Github repo should have more than 30 watchers, 75 stars and 30 watchers and should be more than 30 days old.</p>

<p>Taps on the other hand are your own personal formula repository where formula(e) for your applications can be stored. Homebrew can look up formula(e) from this repo and allow you to install the said application. In this tutorial, we’ll be creating a tap. Now, let’s create a repository where we’ll store our homebrew formulae, let’s call it <a href="https://github.com/prakashdanish/homebrew-formulae"><code class="highlighter-rouge">homebrew-formulae</code></a> and add our formula file here.</p>

<p>We can now install the application via homebrew. But before doing that, we need to tell homebrew where to find our application since it is not there in the <code class="highlighter-rouge">homebrew-core</code> repository. We can do this by the tap command. And installing our application afterwards.</p>

<div class="language-sh highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>brew tap prakashdanish/homebrew-formulae
<span class="gp">$ </span>brew install goodreadsh
</code></pre>
</div>

<p>Another upside to having a designated formula repo (tap) of your own is the simple fact that you can simply add another formula in the future and have it installed in the same way. So this acts like a collection (repo?) of all your application’s formulae making it easier to maintain and update.</p>

<p>–</p>

<h1 id="conclusion">Conclusion</h1>
<p>Hopefully you can now write a homebrew formula for a trivial application and distribute it via homebrew by creating a tap.
There are lots of options for you to consider when you write a formula for your application in the Homebrew <a href="https://github.com/Homebrew/brew/blob/master/docs/Formula-Cookbook.md">Formula Cookbook</a>. I’d suggest taking a good look at the formula cookbook before attempting to write your own formula.</p>

<hr />

    </div>
</div>

        </div>

    </body>

</html>
